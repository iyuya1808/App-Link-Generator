(()=>{"use strict";var e,t={6(e,t,a){const l=window.wp.blocks,r=window.React,o=window.wp.i18n,n=window.wp.blockEditor,s=window.wp.components,p=window.wp.element,i=window.wp.apiFetch;var c=a.n(i);const d=JSON.parse('{"UU":"app-store-links/download-buttons"}');(0,l.registerBlockType)(d.UU,{edit:function({attributes:e,setAttributes:t}){const{appName:a,iconUrl:l,developer:i,price:d,appStoreUrl:m,googlePlayUrl:g,showAppStore:h,showGooglePlay:u,rating:_,reviewCount:v,trackId:y,store:f,lastUpdated:x}=e,[k,w]=(0,p.useState)(""),[E,b]=(0,p.useState)(!1),[C,N]=(0,p.useState)({ios:[],android:[]}),[U,S]=(0,p.useState)(!1),P=(0,n.useBlockProps)(),R=(e,a)=>(0,r.createElement)("div",{key:e.trackId||a,onClick:()=>(async e=>{let a=e.userRatingCount||0;"ios"===e.store&&"number"==typeof a&&(a=a>=1e4?(a/1e4).toFixed(1)+"万件":a.toLocaleString()+"件");const l=new Date,r=`${l.getFullYear()}.${String(l.getMonth()+1).padStart(2,"0")}.${String(l.getDate()).padStart(2,"0")}`;let o={appName:e.trackName,iconUrl:e.artworkUrl512||e.artworkUrl100,developer:e.artistName,price:e.formattedPrice,rating:e.averageUserRating||0,reviewCount:a,trackId:String(e.trackId),store:e.store,lastUpdated:r};if("ios"===e.store)o.appStoreUrl=e.trackViewUrl;else if("google_play"===e.store){o.googlePlayUrl=e.trackViewUrl,b(!0);try{const t=await c()({path:`/app-store-links/v1/lookup?id=${encodeURIComponent(e.trackId)}`});t&&(o.appName=t.trackName||o.appName,o.developer=t.artistName||o.developer,o.iconUrl=t.artworkUrl512||o.iconUrl,o.rating=t.averageUserRating||o.rating,o.reviewCount=t.userRatingCount||o.reviewCount)}catch(e){console.warn("Failed to fetch Google Play details:",e)}finally{b(!1)}}t(o)})(e),className:"app-search-item",style:{padding:"10px",border:"1px solid #ddd",borderRadius:"4px",marginBottom:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",background:"#fff"}},(0,r.createElement)("img",{src:e.artworkUrl60||e.artworkUrl512,alt:e.trackName,style:{borderRadius:"10px",width:"50px",height:"50px",objectFit:"cover"}}),(0,r.createElement)("div",{style:{flex:1,overflow:"hidden"}},(0,r.createElement)("div",{style:{fontWeight:"bold",fontSize:"13px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},e.trackName),(0,r.createElement)("div",{style:{fontSize:"11px",color:"#666"}},e.artistName||("google_play"===e.store?"Google Play":"")),(0,r.createElement)("div",{style:{fontSize:"11px",color:"#666"}},e.formattedPrice||"無料")));return(0,r.createElement)("div",{...P},(0,r.createElement)(n.InspectorControls,null,(0,r.createElement)(s.PanelBody,{title:(0,o.__)("アプリ詳細","app-store-links")},(0,r.createElement)(s.TextControl,{label:(0,o.__)("アプリ名","app-store-links"),value:a,onChange:e=>t({appName:e})}),(0,r.createElement)(s.TextControl,{label:(0,o.__)("アイコンURL","app-store-links"),value:l,onChange:e=>t({iconUrl:e})}),(0,r.createElement)(s.TextControl,{label:(0,o.__)("開発者","app-store-links"),value:i,onChange:e=>t({developer:e})}),(0,r.createElement)(s.TextControl,{label:(0,o.__)("価格","app-store-links"),value:d,onChange:e=>t({price:e})}),(0,r.createElement)(s.TextControl,{label:(0,o.__)("評価 (0-5)","app-store-links"),value:_,type:"number",step:"0.1",min:"0",max:"5",onChange:e=>t({rating:parseFloat(e)})}),(0,r.createElement)(s.TextControl,{label:(0,o.__)("レビュー数","app-store-links"),value:v,onChange:e=>t({reviewCount:e})})),(0,r.createElement)(s.PanelBody,{title:(0,o.__)("ストアリンク","app-store-links")},(0,r.createElement)(s.TextControl,{label:(0,o.__)("App Store URL","app-store-links"),value:m,onChange:e=>t({appStoreUrl:e})}),(0,r.createElement)(s.ToggleControl,{label:(0,o.__)("App Storeリンクを表示","app-store-links"),checked:h,onChange:e=>t({showAppStore:e})}),(0,r.createElement)(s.TextControl,{label:(0,o.__)("Google Play URL","app-store-links"),value:g,onChange:e=>t({googlePlayUrl:e})}),(0,r.createElement)(s.ToggleControl,{label:(0,o.__)("Google Playリンクを表示","app-store-links"),checked:u,onChange:e=>t({showGooglePlay:e})}))),(0,r.createElement)("div",{className:"app-store-links-editor-search",style:{marginBottom:"20px",padding:"15px",border:"1px solid #ddd",background:"#f9f9f9"}},(0,r.createElement)("div",{style:{display:"flex",gap:"10px",alignItems:"center",marginBottom:"15px"}},(0,r.createElement)(s.TextControl,{value:k,onChange:w,placeholder:(0,o.__)("アプリを検索...","app-store-links"),className:"app-search-input",style:{marginBottom:0,flex:1}}),(0,r.createElement)(s.Button,{variant:"primary",onClick:async()=>{if(k){b(!0),S(!0),N({ios:[],android:[]});try{const[e,t]=await Promise.allSettled([fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(k)}&entity=software&country=JP&limit=5`).then(e=>e.json()),c()({path:`/app-store-links/v1/search?term=${encodeURIComponent(k)}`})]);let a={ios:[],android:[]};"fulfilled"===e.status&&e.value.results&&(a.ios=e.value.results.map(e=>({...e,store:"ios"}))),"fulfilled"===t.status&&Array.isArray(t.value)&&(a.android=t.value),N(a)}catch(e){console.error("Search failed:",e)}finally{b(!1)}}},isBusy:E,disabled:E||!k},(0,o.__)("検索","app-store-links"))),U&&(0,r.createElement)("div",{className:"app-search-results-columns",style:{display:"flex",gap:"20px",flexWrap:"wrap"}},(0,r.createElement)("div",{style:{flex:"1 1 300px"}},(0,r.createElement)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px",color:"#666",borderBottom:"1px solid #eee",paddingBottom:"5px"}},(0,r.createElement)("span",{className:"dashicons dashicons-smartphone",style:{color:"#ff6b6b"}}),(0,r.createElement)("span",null,(0,o.__)("iPhoneアプリ検索結果","app-store-links"))),(0,r.createElement)("div",{style:{maxHeight:"400px",overflowY:"auto"}},C.ios.length>0?C.ios.map((e,t)=>R(e,t)):(0,r.createElement)("div",{style:{color:"#999",fontSize:"12px",padding:"10px"}},(0,o.__)("見つかりませんでした。","app-store-links")))),(0,r.createElement)("div",{style:{flex:"1 1 300px"}},(0,r.createElement)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"10px",color:"#666",borderBottom:"1px solid #eee",paddingBottom:"5px"}},(0,r.createElement)("span",{className:"dashicons dashicons-tablet",style:{color:"#4da6ff"}}),(0,r.createElement)("span",null,(0,o.__)("Androidアプリ検索結果","app-store-links"))),(0,r.createElement)("div",{style:{maxHeight:"400px",overflowY:"auto"}},C.android.length>0?C.android.map((e,t)=>R(e,t)):(0,r.createElement)("div",{style:{color:"#999",fontSize:"12px",padding:"10px"}},(0,o.__)("見つかりませんでした。","app-store-links")))))),a?(0,r.createElement)("div",{className:"appreach"},l&&(0,r.createElement)("img",{src:l,alt:a,className:"appreach__icon",style:{float:"left",borderRadius:"10%",overflow:"hidden",margin:"0 3% 0 0",width:"25%",height:"auto",maxWidth:"120px"}}),(0,r.createElement)("div",{className:"appreach__detail",style:{display:"inline-block",width:"72%",maxWidth:"72%"}},(0,r.createElement)("p",{className:"appreach__name",style:{fontSize:"16px",lineHeight:"1.5em",fontWeight:"bold",margin:0}},a),(0,r.createElement)("p",{className:"appreach__info",style:{fontSize:"12px",margin:0}},(0,r.createElement)("span",{className:"appreach__developper",style:{marginRight:"0.5em"}},i),(0,r.createElement)("span",{className:"appreach__price",style:{marginRight:"0.5em"}},d),_>0&&(0,r.createElement)("span",{className:"appreach__star"},(0,r.createElement)("span",{className:"appreach__star__base"},"★★★★★"),(0,r.createElement)("span",{className:"appreach__star__evaluate",style:{width:20*_+"%"}},"★★★★★")),v&&(0,r.createElement)("span",{style:{marginLeft:"5px",color:"#666"}},"(",v,")"),(0,r.createElement)("span",{className:"appreach__posted",style:{display:"block",marginTop:"2px"}},"posted with ",(0,r.createElement)("a",{href:"https://technophere.com",title:"テクノフィア",target:"_blank",rel:"nofollow"},"テクノフィア")))),(0,r.createElement)("div",{className:"appreach__links",style:{clear:"both",marginTop:"8px"}},h&&m&&(0,r.createElement)("a",{href:m,rel:"nofollow",className:"appreach__aslink",style:{display:"inline-block",marginRight:"10px"}},(0,r.createElement)("img",{src:"https://nabettu.github.io/appreach/img/itune_ja.svg",style:{height:"40px",width:"135px"}})),u&&g&&(0,r.createElement)("a",{href:g,rel:"nofollow",className:"appreach__gplink",style:{display:"inline-block"}},(0,r.createElement)("img",{src:"https://nabettu.github.io/appreach/img/gplay_ja.png",style:{height:"40px",width:"134.5px"}}))),x&&(0,r.createElement)("div",{className:"appreach__date"},x,"時点")):(0,r.createElement)(s.Placeholder,{icon:"smartphone",label:"App Store Links"},(0,r.createElement)("p",null,(0,o.__)("アプリを検索して詳細を表示してください。","app-store-links"))))},save:()=>null})}},a={};function l(e){var r=a[e];if(void 0!==r)return r.exports;var o=a[e]={exports:{}};return t[e](o,o.exports,l),o.exports}l.m=t,e=[],l.O=(t,a,r,o)=>{if(!a){var n=1/0;for(c=0;c<e.length;c++){for(var[a,r,o]=e[c],s=!0,p=0;p<a.length;p++)(!1&o||n>=o)&&Object.keys(l.O).every(e=>l.O[e](a[p]))?a.splice(p--,1):(s=!1,o<n&&(n=o));if(s){e.splice(c--,1);var i=r();void 0!==i&&(t=i)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[a,r,o]},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};l.O.j=t=>0===e[t];var t=(t,a)=>{var r,o,[n,s,p]=a,i=0;if(n.some(t=>0!==e[t])){for(r in s)l.o(s,r)&&(l.m[r]=s[r]);if(p)var c=p(l)}for(t&&t(a);i<n.length;i++)o=n[i],l.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return l.O(c)},a=globalThis.webpackChunkapp_link_generator=globalThis.webpackChunkapp_link_generator||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var r=l.O(void 0,[350],()=>l(6));r=l.O(r)})();